<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="一人、一桌、一椅、一扇、一抚尺如故">
    <meta name="author" content="Kaliludan" />
    <title>为 Jekyll 博客启用免费 SSL | Kaliludan</title>
    <link rel="shortcut icon" href="/favicon.png">
    <link href="http://localhost:4000/feed/" rel="alternate" title="Kaliludan" type="application/atom+xml" />
    <link rel="stylesheet" href="kaliludan.github.com/media/css">
    <link rel="stylesheet" href="kaliludan.github.com/media/css/highlight.css">
    <script type="text/javascript" src="kaliludan.github.com/media/js/jquery-1.7.1.min.js"></script>
  </head>

  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <h1><center><a class="" href="http://localhost:4000/">通向蜘蛛巢的小径</a></center></h1>  
        </header>
        <center> <ul class="nav pills">
        <li><a title="主站" class="" href="http://www.kaliludan.com" target="_blank">主页</a></li>
        <li><a title="文章列表" class="" href="http://localhost:4000/archive/">归档</a></li>
        <li><a title="文章分类" class="" href="http://localhost:4000/categories/">分类</a></li>
        <li><a title="关于我和博客" class="" href="http://localhost:4000/about/">关于</a></li>
        <li><a title="个人简历" class="" href="http://localhost:4000/vitae/">简历</a></li>
        <li><a title="论文著作" class="" href="http://localhost:4000/publication/">发表</a></li>
        <li><a title="各种链接" class="" href="http://localhost:4000/links/">链接</a></li>

       </ul> </center>

        <article class="content">
        <h2>
  <center>为 Jekyll 博客启用免费 SSL</center>
</h2>
<h5>文/<a href="http://songchunlin.net/">宋春林</a></h5>
<section class="post">
<p>本来基于 Github Pages 的静态页面默认就是支持 HTTPS 的，但是绑定了自定义域名这个默认选项就无效了。HTTPS 的好处不容多说，之前一直因为 SSL 证书昂贵的价格而没有配置。偶然发现 <a href="https://www.cloudflare.com">Cloudflare</a> 提供了免费的 SSL，于是就用为我的博客开启了 HTTPS。</p>

<p>开启的步骤非常简单，去 <a href="https://www.cloudflare.com">Cloudflare</a> 的网站注册账号，选择免费套餐，添加域名，一直到最后一步会提示更改 Name Server 为新分配的地址。这个时候只需要登录域名提供商（比如我的是 GoDaddy）进入管理域名页面，把域名服务器替换为 Cloudlfare 提供的 Name Server。我第一次设置的时候把 Cloudlfare 提供的 Name Server 和之前的 Name Server 并列，等了大半天都没有生效，删除之前的 DNSPod 的 Name Server 立马就生效了，网站也正常访问。设置完成后尝试再次添加 DNSPod 的 Name Server，Chrome 访问直接提示不安全，一看是因为把 SSL 证书解析到 github.com 了，所以必须删除之前的域名服务器地址。</p>

<p>添加完了稍等几分钟，用 HTTPS 前缀 <a href="https://songchunlin.net/">https://songchunlin.net/</a> 就可以访问了。但是这时还必须手动输入 HTTPS 才能访问加密站点，HTTP 前缀访问还是老样子，需要做一点设置让 HTTP 强制跳转 HTTPS。</p>

<p>做法是在 layout 文件的 &lt;head&gt; 标签下添加如下代码：</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w"> 
      </span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"text/javascript"</span><span class="o">&gt;</span><span class="w">
        </span><span class="n">var</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"enter your site url here"</span><span class="p">;</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">host</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">window.location.host</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">window.location.protocol</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"https:"</span><span class="p">))</span><span class="w">
            </span><span class="n">window.location.protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https"</span><span class="p">;</span><span class="w">
    </span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span></code></pre></figure>

<p>修改后 commit 到 GitHub 上应该就可以强制跳转 HTTPS 了，个别站点会出现 HTTPS 叹号，这是因为页面的少数资源不是加密的，比如我的多说评论里面从新浪微博调取的头像就不是加密的，导致浏览器认为整个页面不安全。还有我使用的公式服务  MathJax，之前并不是 HTTPS的，去官网查了最新的代码修改即可：</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w"> 
</span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s1">'https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span></code></pre></figure>

<p>其实对于个人网站 SSL 并不是一个必须的选项，连我大中科院的网站至今都没有 SSL 加密，但是看到那行绿色的字母心里还是挺舒服的，有这个作用就值了。</p>

<hr />
<p>12月5日更新：由于使用 HTTPS 之后博客访问速度大大减缓，得不偿失，所以取消了 HTTPS。</p>

</section>
<section class="meta">
<span class="author">
  <a>发表于</a>
</span>
<span class="time">
  
  <time datetime="2016-12-04">2016-12-04</time>
</span>
<br />


<span class="categories">
  分类
  
  <a href="http://localhost:4000/categories/#器物杂谈" title="器物杂谈">器物杂谈</a>&nbsp;
  
</span>


<span class="tags">
  标签 
  
  <a href="http://localhost:4000/tags/#博客" title="博客">博客</a>&nbsp;
  
  <a href="http://localhost:4000/tags/#HTTPS" title="HTTPS">HTTPS</a>&nbsp;
  
  <a href="http://localhost:4000/tags/#SSL" title="SSL">SSL</a>&nbsp;
  
</span>

</section>

<section class="comment">

<div id="ds-thread" class="ds-thread" data-url="/2016/12/enable-https-for-Jekyll-blog/" data-title="为 Jekyll 博客启用免费 SSL" data-thread-key="为 Jekyll 博客启用免费 SSL" ></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"songchunlin2016"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>                          
</section>
    
                                  


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://localhost:4000/2016/11/hyp-paper/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://localhost:4000/2016/12/hydrology-on-nature-journal/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>

<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script>
MathJax.Hub.Config({
    tex2jax: {
		skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
	}
});
MathJax.Hub.Queue(function() {
	var all = MathJax.Hub.getAllJax(), i;
	for(i=0; i < all.length; i += 1) {
		all[i].SourceElement().parentNode.className += ' has-jax';
	}
});
</script>

        </article>
          <div><script>
  (function() {
    var cx = '006295899379521077361:pwotjnjztng';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
      </div>
    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-49016899-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    </body>
    
<footer><p><small><center>
              <a href="" title="RSS 订阅" target="_blank" >RSS</a>
            </center></small></p>
</footer>
</html>
